tinymce.PluginManager.add('typekit', function(editor) {

	editor.on('init', function() {
		var typekitId = editor.settings.typekitId;
		if (typekitId) {
		    // Get the iframe.
		    var doc = editor.getDoc();
	        // Create the script to inject into the header asynchronously.
	        //var jscript = "(function() { var config = { kitId: '"+typekitId+"' }; var d = false, tk = document.createElement('script'); tk.src = '//use.typekit.net/' + config.kitId + '.js'; tk.type = 'text/javascript'; tk.async = 'true'; tk.onload = tk.onreadystatechange = function() { var rs = this.readyState; if (d || rs && rs != 'complete' && rs != 'loaded') return; d = true; try { Typekit.load(config); } catch (e) {} }; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(tk, s); })();";

			//This is the Async version
			var jscript = "(function(d) { var config = { kitId: '"+typekitId+"', scriptTimeout: 3000, async: true },h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,'')+' wf-inactive';},config.scriptTimeout),tk=d.createElement('script'),f=false,s=d.getElementsByTagName('script')[0],a;h.className+=' wf-loading';tk.src='https://use.typekit.net/"+typekitId+".js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!='complete'&&a!='loaded')return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)})(document);";

		    // Create a DOM script element and insert the code inside of it.
		    var script  = doc.createElement("script");
		    script.type = "text/javascript";
		    script.appendChild(doc.createTextNode(jscript));
		    // Append the srcript to the header.
		    doc.getElementsByTagName('head')[0].appendChild(script);
	    }
	});

});